<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="hello world"><title>Android--Service组件 | SunnyBird' s Space</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android--Service组件</h1><a id="logo" href="/.">SunnyBird' s Space</a><p class="description">大道至简，知易行难</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android--Service组件</h1><div class="post-meta">Apr 2, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>转载来源  <a href="http://blog.csdn.net/ithomer/article/details/7364024" target="_blank" rel="external">http://blog.csdn.net/ithomer/article/details/7364024</a></p>
<h3 id="一、-Service简介"><a href="#一、-Service简介" class="headerlink" title="一、 Service简介"></a>一、 Service简介</h3><p>Service是android系统中的四大组件之一（Activity、Service、BroadcastReceiver、ContentProvider），它跟Activity的级别差不多，但不能自己运行只能后台运行，并且可以和其他组件进行交互。service可以在很多场合的应用中使用，比如播放多媒体的时候用户启动了其他Activity这个时候程序要在后台继续播放，比如检测SD卡上文件的变化，再或者在后台记录你地理信息位置的改变等等，总之服务总是藏在后台的。</p>
<p>Service的启动有两种方式：<br>context.startService() 和 context.bindService()</p>
<h3 id="二、-Service启动流程"><a href="#二、-Service启动流程" class="headerlink" title="二、 Service启动流程"></a>二、 Service启动流程</h3><p>context.startService() 启动流程：<br>context.startService()  -&gt; onCreate()  -&gt; onStart()  -&gt; Service running  -&gt; context.stopService()  -&gt; onDestroy()  -&gt; Service stop</p>
<p>如果Service还没有运行，则android先调用onCreate()，然后调用onStart()；</p>
<p>如果Service已经运行，则只调用onStart()，所以一个Service的onStart方法可能会重复调用多次。</p>
<p>如果stopService的时候会直接onDestroy，如果是调用者自己直接退出而没有调用stopService的话，Service会一直在后台运行，该Service的调用者再启动起来后可以通过stopService关闭Service。</p>
<p>所以调用startService的生命周期为：onCreate –&gt; onStart (可多次调用) –&gt; onDestroy</p>
<p>context.bindService()启动流程：<br>context.bindService()  -&gt; onCreate()  -&gt; onBind()  -&gt; Service running  -&gt; onUnbind()  -&gt; onDestroy()  -&gt; Service stop</p>
<p>onBind()将返回给客户端一个IBind接口实例，IBind允许客户端回调服务的方法，比如得到Service的实例、运行状态或其他操作。这个时候把调用者（Context，例如Activity）会和Service绑定在一起，Context退出了，Srevice就会调用onUnbind-&gt;onDestroy相应退出。</p>
<p>所以调用bindService的生命周期为：  onCreate –&gt; onBind(只一次，不可多次绑定) –&gt; onUnbind –&gt; onDestory。</p>
<p>在Service每一次的开启关闭过程中，只有onStart可被多次调用(通过多次startService调用)，其他onCreate，onBind，onUnbind，onDestory在一个生命周期中只能被调用一次。</p>
<h3 id="三、-Service生命周期"><a href="#三、-Service生命周期" class="headerlink" title="三、 Service生命周期"></a>三、 Service生命周期</h3><p>Service的生命周期并不像Activity那么复杂，它只继承了onCreate()、onStart()、onDestroy()三个方法</p>
<p>当我们第一次启动Service时，先后调用了onCreate()、onStart()这两个方法；当停止Service时，则执行onDestroy()方法。</p>
<p>这里需要注意的是，如果Service已经启动了，当我们再次启动Service时，不会在执行onCreate()方法，而是直接执行onStart()方法。<br>它可以通过Service.stopSelf()方法或者Service.stopSelfResult()方法来停止自己，只要调用一次stopService()方法便可以停止服务，无论调用了多少次的启动服务方法。</p>
<h3 id="四、-拓展知识（进程和生命周期）"><a href="#四、-拓展知识（进程和生命周期）" class="headerlink" title="四、 拓展知识（进程和生命周期）"></a>四、 拓展知识（进程和生命周期）</h3><p>Android操作系统尝试尽可能长时间的保持应用的进程，但当可用内存很低时最终要移走一部分进程。怎样确定那些程序可以运行，那些要被销毁，Android让每一个进程在一个重要级的基础上运行，重要级低的进程最有可能被淘汰，一共有5级，下面这个列表就是按照重要性排列的：</p>
<p>1.一个前台进程显示的是用户此时需要处理和显示的。下列的条件有任何一个成立，这个进程都被认为是在前台运行的。      </p>
<blockquote>
<p>a. 与用户正发生交互的。<br>b. 它控制一个与用户交互的必须的基本的服务。<br>c. 有一个正在调用生命周期的回调函数的service（如onCreate()、onStar()、onDestroy()）<br>d. 它有一个正在运行onReceive()方法的广播接收对象。</p>
</blockquote>
<p>只有少数的前台进程可以在任何给定的时间内运行，销毁他们是系统万不得已的、最后的选择——当内存不够系统继续运行下去时。通常，在这一点上，设备已经达到了内存分页状态，所以杀掉一些前台进程来保证能够响应用户的需求。</p>
<p>2.一个可用进程没有任何前台组件，但它仍然可以影响到用户的界面。下面两种情况发生时，可以称该进程为可用进程。<br>        它是一个非前台的activity，但对用户仍然可用（onPause()方法已经被调用）这是可能发生的，例如：前台的activity是一个允许上一个activity可见的对话框，即当前activity半透明，能看到前一个activity的界面，它是一个服务于可用activity的服务。</p>
<p>3.一个服务进程是一个通过调用startService()方法启动的服务，并且不属于前两种情况。尽管服务进程没有直接被用户看到，但他们确实是用户所关心的，比如后台播放音乐或网络下载数据。所以系统保证他们的运行，直到不能保证所有的前台可见程序都正常运行时才会终止他们。</p>
<p>4.一个后台进程就是一个非当前正在运行的activity（activity的onStop()方法已经被调用），他们不会对用户体验造成直接的影响，当没有足够内存来运行前台可见程序时，他们将会被终止。通常，后台进程会有很多个在运行,所以他们维护一个LRU最近使用程序列表来保证经常运行的activity能最后一个被终止。如果一个activity正确的实现了生命周期的方法，并且保存它当前状态，杀死这些进程将不会影响到用户体验。<br>5.一个空线程没有运行任何可用应用程序组，保留他们的唯一原因是为了设立一个缓存机制，来加快组件启动的时间。系统经常杀死这些内存来平衡系统的整个系统的资源，进程缓存和基本核心缓存之间的资源。<br>Android把进程里优先级最高的activity或服务，作为这个进程的优先级。例如，一个进程拥有一个服务和一个可见的activity，那么这个进程将会被定义为可见进程，而不是服务进程。</p>
<p>此外，如果别的进程依赖某一个进程的话，那么被依赖的进程会提高优先级。一个进程服务于另一个进程，那么提供服务的进程不会低于获得服务的进程。例如，如果进程A的一个内容提供商服务于进程B的一个客户端，或者进程A的一个service被进程B的一个组件绑定，那么进程A至少拥有和进程B一样的优先级，或者更高。</p>
<p>因为一个运行服务的进程的优先级高于运行后台activity的进程，一个activity会准备一个长时间运行的操作来启动一个服务，而不是启动一个线程–尤其是这个操作可能会拖垮这个activity。例如后台播放音乐的同时，通过照相机向服务器发送一张照片，启动一个服务会保证这个操作至少运行在service 进程的优先级下，无论这个activity发生了什么，广播接收者应该作为一个空服务而不是简单的把耗时的操作单独放在一个线程里。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/04/02/Android-Service组件/" data-id="cj1i3ejug0007fh0x5mtdjwty" class="article-share-link">分享到</a><div class="tags"><a href="/tags/android/">android</a></div><div class="post-nav"><a href="/2016/03/17/Android5.1兼容flash方案/" class="pre">Android5.1兼容flash方案</a><a href="/2016/06/26/Android-RadioButton实践/" class="next">Android-RadioButton实践</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/tools/" style="font-size: 15px;">tools</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/14/基于Android平台编译FFmpeg-3-2-4/">基于Android平台编译FFmpeg-3.2.4</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/11/Android平台可执行二进制程序/">Android平台可执行二进制程序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/02/Android加壳那些事/">Android加壳那些事</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/Android-网络通信方式/">Android--网络通信方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/20/Android-Activity组件/">Android--Activity组件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/11/Android-App退出方案/">Android--App退出方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/26/Android-RadioButton实践/">Android-RadioButton实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/02/Android-Service组件/">Android--Service组件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/17/Android5.1兼容flash方案/">Android5.1兼容flash方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/22/Android中自定义通知声音/">Android中自定义通知声音</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.csdn.net/jinlongfeng123" title="Sunny@CSDN" target="_blank">Sunny@CSDN</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">SunnyBird' s Space.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>